<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valuation Pro: DCF + Bazin + Qualidade</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f0f2f5;
            padding: 20px;
            color: #1a202c;
        }
        .container { max-width: 1100px; margin: 0 auto; }
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .grid { display: grid; gap: 16px; }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        label { display: block; font-weight: 600; font-size: 13px; margin-bottom: 5px; color: #4a5568; }
        input {
            width: 100%; padding: 10px; border: 2px solid #e2e8f0;
            border-radius: 8px; font-size: 14px; outline: none;
        }
        input:focus { border-color: #4a90e2; }
        .btn {
            padding: 14px; border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer; transition: 0.3s; width: 100%;
        }
        .btn-primary { background: #2b6cb0; color: white; margin-top: 10px; }
        .btn-primary:hover { background: #2c5282; }
        .res-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .valuation-card {
            padding: 20px; border-radius: 12px; text-align: center; color: white;
        }
        .dcf-box { background: #2f855a; }
        .bazin-box { background: #2c5282; }
        .preco-val { font-size: 42px; font-weight: 800; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; font-size: 14px; }
        th { background: #f7fafc; color: #718096; }
        .badge-pos { color: #2f855a; font-weight: bold; }
        .badge-neg { color: #c53030; font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h1>üìä Terminal de Valuation Integrado</h1>
        <p style="color: #718096; margin-bottom: 15px;">DCF (FCFE), Pre√ßo Teto Bazin e Combo de Qualidade</p>
        <div class="grid grid-3">
            <button class="btn" style="background: #edf2f7;" onclick="usarExemplo()">üéØ Carregar Exemplo (PRIO3)</button>
            <button class="btn" style="background: #edf2f7;" onclick="window.location.reload()">üóëÔ∏è Limpar Tudo</button>
            <input type="file" id="excelInput" accept=".xls,.xlsx" style="border: 2px dashed #cbd5e0;">
        </div>
    </div>

    <div class="card">
        <h2>üí∞ Dados Financeiros & Operacionais</h2>
        <div class="grid grid-3">
            <div class="input-group"><label>Lucro L√≠quido (R$ Mi)</label><input type="number" id="lucroLiq"></div>
            <div class="input-group"><label>EBIT (R$ Mi)</label><input type="number" id="ebit"></div>
            <div class="input-group"><label>Receita L√≠quida (R$ Mi)</label><input type="number" id="receita"></div>
            <div class="input-group"><label>Deprecia√ß√£o/Amort. (R$ Mi)</label><input type="number" id="depre"></div>
            <div class="input-group"><label>CAPEX (R$ Mi)</label><input type="number" id="capex"></div>
            <div class="input-group"><label>Varia√ß√£o NCG (R$ Mi)</label><input type="number" id="ncgVar"></div>
            <div class="input-group"><label>Fluxo de D√≠vida (L√≠quido)</label><input type="number" id="fluxoDiv"></div>
            <div class="input-group"><label>Ativo Total (R$ Mi)</label><input type="number" id="ativo"></div>
            <div class="input-group"><label>N¬∫ de A√ß√µes</label><input type="number" id="numAcoes"></div>
        </div>
    </div>

    <div class="card">
        <h2>‚öôÔ∏è Premissas de Crescimento e Desconto</h2>
        <div class="grid grid-3">
            <div class="input-group"><label>Taxa de Desconto (DI+2%)</label><input type="number" id="ke" value="13.5"></div>
            <div class="input-group"><label>Yield Desejado Bazin (%)</label><input type="number" id="yieldBazin" value="8"></div>
            <div class="input-group"><label>Crescimento Perp√©tuo (g) %</label><input type="number" id="gPerp" value="3"></div>
            <div class="input-group"><label>Payout Estimado (%)</label><input type="number" id="payout" value="25"></div>
            <div class="input-group"><label>Patrim√¥nio L√≠quido (R$ Mi)</label><input type="number" id="pl"></div>
        </div>
        <button class="btn btn-primary" onclick="executarValuation()">üöÄ RODAR AN√ÅLISE COMPLETA</button>
    </div>

    <div id="resultadoArea" class="hidden"></div>
</div>

<script>
    function usarExemplo() {
        document.getElementById('lucroLiq').value = 4200;
        document.getElementById('ebit').value = 5800;
        document.getElementById('receita').value = 12500;
        document.getElementById('depre').value = 1100;
        document.getElementById('capex').value = 2400;
        document.getElementById('ncgVar').value = -120;
        document.getElementById('fluxoDiv').value = 500;
        document.getElementById('ativo').value = 35000;
        document.getElementById('numAcoes').value = 880000000;
        document.getElementById('pl').value = 18000;
    }

    function executarValuation() {
        // Coleta de dados
        const lucro = parseFloat(document.getElementById('lucroLiq').value) || 0;
        const ebit = parseFloat(document.getElementById('ebit').value) || 0;
        const receita = parseFloat(document.getElementById('receita').value) || 1;
        const depre = parseFloat(document.getElementById('depre').value) || 0;
        const capex = parseFloat(document.getElementById('capex').value) || 0;
        const ncgVar = parseFloat(document.getElementById('ncgVar').value) || 0;
        const fluxoDiv = parseFloat(document.getElementById('fluxoDiv').value) || 0;
        const numAcoes = parseFloat(document.getElementById('numAcoes').value) || 1;
        const ke = parseFloat(document.getElementById('ke').value) / 100;
        const g = parseFloat(document.getElementById('gPerp').value) / 100;
        const yieldBazin = parseFloat(document.getElementById('yieldBazin').value) / 100;
        const payout = parseFloat(document.getElementById('payout').value) / 100;
        const ativo = parseFloat(document.getElementById('ativo').value) || 1;
        const pl = parseFloat(document.getElementById('pl').value) || 1;

        // 1. DCF (FCFE)
        const fcfe0 = lucro + depre - capex - ncgVar + fluxoDiv;
        const precoDCF = ((fcfe0 * (1 + g)) / (ke - g) * 1000000) / numAcoes;

        // 2. Pre√ßo Teto Bazin
        const dpaSustentavel = (lucro * payout * 1000000) / numAcoes;
        const precoBazin = dpaSustentavel / yieldBazin;

        // 3. Combo de Qualidade e Retorno
        const fco = lucro + depre - ncgVar;
        const roic = (ebit * 0.85) / pl; // Simplifica√ß√£o NOPAT/PL para exemplo
        const efCaixa = (ebit - ncgVar) / ebit;
        const accruals = (lucro - fco) / ativo;
        const reinvestimento = (capex - depre + ncgVar) / (ebit * 0.85);
        const gSustentavel = reinvestimento * roic;

        const resArea = document.getElementById('resultadoArea');
        resArea.classList.remove('hidden');
        resArea.innerHTML = `
            <div class="res-grid">
                <div class="valuation-card dcf-box">
                    <h3>Pre√ßo Justo DCF (FCFE)</h3>
                    <div class="preco-val">R$ ${precoDCF.toLocaleString('pt-BR', {maximumFractionDigits:2})}</div>
                    <p>Foco em Gera√ß√£o de Caixa Livre</p>
                </div>
                <div class="valuation-card bazin-box">
                    <h3>Pre√ßo Teto Bazin (${(yieldBazin*100).toFixed(0)}%)</h3>
                    <div class="preco-val">R$ ${precoBazin.toLocaleString('pt-BR', {maximumFractionDigits:2})}</div>
                    <p>Foco em Dividendos (Payout ${(payout*100).toFixed(0)}%)</p>
                </div>
            </div>

            <div class="card" style="margin-top:20px;">
                <h2>An√°lise de Qualidade e Sustentabilidade</h2>
                <table>
                    <thead>
                        <tr><th>Indicador</th><th>Valor</th><th>An√°lise</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><b>Efici√™ncia de Caixa</b></td>
                            <td>${(efCaixa * 100).toFixed(2)}%</td>
                            <td>${efCaixa > 0.8 ? "‚úÖ Alta convers√£o" : "‚ö†Ô∏è Monitorar capital de giro"}</td>
                        </tr>
                        <tr>
                            <td><b>Accruals Ratio</b></td>
                            <td>${accruals.toFixed(4)}</td>
                            <td>${accruals < 0 ? "‚úÖ Lucro Conservador" : "‚ùå Lucro Cont√°bil (Alerta)"}</td>
                        </tr>
                        <tr>
                            <td><b>Crescimento Sustent√°vel (g)</b></td>
                            <td>${(gSustentavel * 100).toFixed(2)}%</td>
                            <td>Baseado em Reinvestimento e ROIC</td>
                        </tr>
                        <tr>
                            <td><b>Validar Perpetuidade</b></td>
                            <td>${(g*100).toFixed(2)}%</td>
                            <td>${g <= gSustentavel ? "‚úÖ Sustent√°vel" : "‚ùå g da perpetuidade acima do g sustent√°vel"}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;
    }
</script>
</body>
</html>
